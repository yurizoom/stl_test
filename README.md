# Slot Booking Service

–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ—Ç–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ–≤–µ—Ä—Å–µ–ª–∞, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

## –°—Ç–µ–∫:
* PHP 8.2+
* Laravel 12
* MySQL 8+
* PHPUnit

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
### 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```bash
git clone <repo-url>
cd <project>
```

### 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
composer install
```

### 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp .env.example .env
```

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL –≤ .env:
```dotenv
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=slots
DB_USERNAME=root
DB_PASSWORD=
```

### 4Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
php artisan key:generate
```

### 5Ô∏è‚É£ –ú–∏–≥—Ä–∞—Ü–∏–∏
```bash
php artisan migrate
```

### 6Ô∏è‚É£ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
php artisan serve
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:
```
http://127.0.0.1:8000
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
php artisan test
```

## üìò API
### 1Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª–æ—Ç–æ–≤
```bash
curl -X GET http://127.0.0.1:8000/api/slots/availability
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
[
    {
        "slot_id": 1,
        "capacity": 10,
        "remaining": 6
    }
]
```

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Ö–æ–ª–¥–∞
```bash
curl -X POST http://127.0.0.1:8000/api/slots/1/hold \
-H "Idempotency-Key: 11111111-1111-1111-1111-111111111111"
```

–û—Ç–≤–µ—Ç:
```json
{
    "id": 1,
    "slot_id": 1,
    "status": "held"
}
```

### 3Ô∏è‚É£ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ Idempotency-Key
```bash
curl -X POST http://127.0.0.1:8000/api/slots/1/hold \
-H "Idempotency-Key: 11111111-1111-1111-1111-111111111111"
```

–í–µ—Ä–Ω—ë—Ç—Å—è —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π hold (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).

### 4Ô∏è‚É£ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ö–æ–ª–¥–∞
```bash
curl -X POST http://127.0.0.1:8000/api/holds/1/confirm
```

–ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞ ‚Äî —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω–µ—Ç confirmed, –∞ remaining —É–º–µ–Ω—å—à–∏—Ç—Å—è –Ω–∞ 1.

### 5Ô∏è‚É£ –û—Ç–º–µ–Ω–∞ —Ö–æ–ª–¥–∞
```bash
curl -X DELETE http://127.0.0.1:8000/api/holds/1
```

–ï—Å–ª–∏ —Ö–æ–ª–¥ –±—ã–ª confirmed ‚Äî —Å–ª–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–æ—Å—Ç—É–ø.

### 6Ô∏è‚É£ –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ –æ–≤–µ—Ä—Å–µ–ª–µ

–ï—Å–ª–∏ remaining = 0:

```bash
curl -X POST http://127.0.0.1:8000/api/slots/1/hold \
-H "Idempotency-Key: 22222222-2222-2222-2222-222222222222"
```

–û—Ç–≤–µ—Ç:
```json
{
"message": "No remaining capacity."
}
```

HTTP —Å—Ç–∞—Ç—É—Å:

409 Conflict

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ SELECT FOR UPDATE –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race condition.
* –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–≤–µ—Ä—Å–µ–ª–∞.
* –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π idempotency_key.
* –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ availability –Ω–∞ 10 —Å–µ–∫—É–Ω–¥.
* –ó–∞—â–∏—Ç–∞ –æ—Ç cache stampede —á–µ—Ä–µ–∑ Cache::lock().
